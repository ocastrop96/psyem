$("#deshacer-filtro-Fam").on("click",function(){window.location="familiares"}),$("#rango-familiar").daterangepicker({ranges:{Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 días":[moment().subtract(6,"days"),moment()],"Últimos 30 días":[moment().subtract(29,"days"),moment()],"Este mes":[moment().startOf("month"),moment().endOf("month")],"Último mes":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},startDate:moment(),endDate:moment(),maxSpan:{days:30},opens:"left",locale:{format:"DD/MM/YYYY",separator:" - ",applyLabel:"APLICAR",cancelLabel:"CANCELAR",fromLabel:"Desde",toLabel:"Hasta",customRangeLabel:"Personalizar",weekLabel:"W",daysOfWeek:["Do","Lu","Ma","Mie","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Setiembre","Octubre","Noviembre","Diciembre"],firstDay:1}},function(e,a){$("#daterange-btn span").html(e.format("MMMM D, YYYY")+"-"+a.format("MMMM D, YYYY"));var t=e.format("YYYY-MM-DD"),o=a.format("YYYY-MM-DD"),n=$("#daterange-btn span").html();let i;localStorage.setItem("capRangoFam",n),window.location="index.php?ruta=familiares&fechaInicialFam="+t+"&fechaFinalFam="+o,Swal.fire({title:"Se está cargando la información",html:"Espere por favor...",timer:7e3,timerProgressBar:!0,onBeforeOpen:()=>{Swal.showLoading(),i=setInterval(()=>{const e=Swal.getContent();if(e){const a=e.querySelector("b");a&&(a.textContent=Swal.getTimerLeft())}},100)},onClose:()=>{clearInterval(i)}}).then(e=>{e.dismiss,Swal.DismissReason.timer})}),$(".daterangepicker.opensleft .drp-buttons .cancelBtn").on("click",function(){let e;localStorage.removeItem("capRangoFam"),localStorage.clear(),window.location="familiares",Swal.fire({title:"Se está cargando la información",html:"Espere por favor...",timer:7e3,timerProgressBar:!0,onBeforeOpen:()=>{Swal.showLoading(),e=setInterval(()=>{const e=Swal.getContent();if(e){const a=e.querySelector("b");a&&(a.textContent=Swal.getTimerLeft())}},100)},onClose:()=>{clearInterval(e)}}).then(e=>{e.dismiss===Swal.DismissReason.timer&&console.log("I was closed by the timer")})}),$(".daterangepicker.opensleft .ranges li").on("click",function(){if("Hoy"==$(this).attr("data-range-key")){var e=new Date,a=e.getDate(),t=e.getMonth()+1,o=e.getFullYear();a=("0"+a).slice(-2);var n=o+"-"+(t=("0"+t).slice(-2))+"-"+a,i=o+"-"+t+"-"+a;let r;localStorage.setItem("capRangoFam","Hoy"),window.location="index.php?ruta=familiares&fechaInicialFam="+n+"&fechaFinalFam="+i,Swal.fire({title:"Se está cargando la información",html:"Espere por favor...",timer:7e3,timerProgressBar:!0,onBeforeOpen:()=>{Swal.showLoading(),r=setInterval(()=>{const e=Swal.getContent();if(e){const a=e.querySelector("b");a&&(a.textContent=Swal.getTimerLeft())}},100)},onClose:()=>{clearInterval(r)}}).then(e=>{e.dismiss===Swal.DismissReason.timer&&console.log("I was closed by the timer")})}}),$(".datatableFamiliares").DataTable({deferRender:!0,retrieve:!0,processing:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,order:[[1,"desc"]],info:!0,autoWidth:!1,language:{url:"public/views/resources/js/dataTables.spanish.lang"}}),$("#rgfAtencion").select2({maximumInputLength:"12",minimumInputLength:"2",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."},inputTooShort:function(){return"Ingrese 2 o más caracteres"},inputTooLong:function(){return"Ingrese máximo 12 caracteres"}},scrollAfterSelect:!0,placeholder:"Ingrese N° de DNI,CE,PASS o Nombres del Paciente",ajax:{url:"public/views/src/ajaxFamiliares.php",type:"post",dataType:"json",delay:150,data:function(e){return{searchTerm:e.term}},processResults:function(e){return{results:e}},cache:!0}}),$("#rgfNdoc").attr("minlength","8"),$("#rgfNdoc").attr("maxlength","12"),$("#rgfTel").attr("minlength","7"),$("#rgfTel").attr("maxlength","9"),$("#rgfEdad").attr("minlength","1"),$("#rgfEdad").attr("maxlength","3"),$("#rgfNdoc").keyup(function(){this.value=(this.value+"").replace(/[^0-9]/g,"")}),$("#rgfNomAp").keyup(function(){this.value=(this.value+"").replace(/[^a-zA-ZñÑáéíóúüÁÉÍÓÚÜ ]/g,"")}),$("#rgfNomAp").keyup(function(){var e=$(this).val().toUpperCase();$("#rgfNomAp").val(e)}),$("#rgfEdad").keyup(function(){this.value=(this.value+"").replace(/[^0-9]/g,"")}),$("#rgfTel").keyup(function(){this.value=(this.value+"").replace(/[^0-9]/g,"")}),$("#edtfAtencion1").select2({maximumInputLength:"10",minimumInputLength:"2",language:{noResults:function(){return"No hay resultado"},searching:function(){return"Buscando.."},inputTooShort:function(){return"Ingrese 2 o más caracteres"},inputTooLong:function(){return"Ingrese máximo 10 caracteres"}},scrollAfterSelect:!0,placeholder:"Ingrese N° de DNI,CE,PASS o Nombres del Paciente",ajax:{url:"public/views/src/ajaxFamiliares.php",type:"post",dataType:"json",delay:150,data:function(e){return{searchTerm:e.term}},processResults:function(e){return $("#seleccionActual1").remove(),$("#seleccionActual").remove(),{results:e}},cache:!0}}),$("#edtfNdoc").attr("minlength","8"),$("#edtfNdoc").attr("maxlength","12"),$("#edtfTel").attr("minlength","7"),$("#edtfTel").attr("maxlength","9"),$("#edtfEdad").attr("minlength","1"),$("#edtfEdad").attr("maxlength","3"),$("#edtfNdoc").keyup(function(){this.value=(this.value+"").replace(/[^0-9]/g,"")}),$("#edtfNomAp").keyup(function(){this.value=(this.value+"").replace(/[^a-zA-ZñÑáéíóúüÁÉÍÓÚÜ ]/g,"")}),$("#edtfNomAp").keyup(function(){var e=$(this).val().toUpperCase();$("#edtfNomAp").val(e)}),$("#edtfEdad").keyup(function(){this.value=(this.value+"").replace(/[^0-9]/g,"")}),$("#edtfTel").keyup(function(){this.value=(this.value+"").replace(/[^0-9]/g,"")}),$("#rgfTdoc").on("change",function(){var e=$(this).val();"DNI"!=e&&("SD"==e?($("#rgfNdoc").val("09999999"),$("#rgfNomAp").val(""),$("#rgfNomAp").focus()):($("#rgfNdoc").val(""),$("#rgfNomAp").val(""),$("#rgfNomAp").prop("readonly",!1),$("#rgfNdoc").focus()))}),$("#btnDNIFam").on("click",function(){var e=$("#rgfTdoc").val(),a=$("#rgfNdoc").val();8==a.length&&"DNI"==e&&$.ajax({type:"GET",url:"https://dniruc.apisperu.com/api/v1/dni/"+a+"?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6Im9jYXN0cm9wLnRpQGdtYWlsLmNvbSJ9.XtrYx8wlARN2XZwOZo6FeLuYDFT6Ljovf7_X943QC_E",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){null!=e.nombres?(toastr.success("Datos cargados con éxito","RENIEC"),$("#rgfNomAp").val(e.nombres+" "+e.apellidoPaterno+" "+e.apellidoMaterno),$("#rgfSexo").focus(),$("#rgfNomAp").prop("readonly",!0)):(toastr.warning("Es un menor de edad, ingrese datos manualmente","RENIEC"),$("#rgfNomAp").focus(),$("#rgfNomAp").val(""),$("#rgfNomAp").prop("readonly",!1))},failure:function(e){toastr.info("No se pudo conectar los datos","DNI")},error:function(e){$("#rgfNomAp").prop("readonly",!1),$("#rgDni").focus(),$("#formRegFam").trigger("reset")}})}),$.validator.addMethod("valueNotEquals",function(e,a,t){return t!==e},"Value must not equal arg."),$("#btnRegFam").on("click",function(){$("#formRegFam").validate({rules:{rgfAtencion:{valueNotEquals:"0",required:!0},rgfTdoc:{valueNotEquals:"0",required:!0},rgfNdoc:{required:!0,maxlength:12,minlength:8},rgfNomAp:{required:!0},rgfSexo:{valueNotEquals:"0",required:!0},rgfParent:{valueNotEquals:"0",required:!0},rgfEdad:{required:!0,maxlength:3,minlength:1},rgfTel:{required:!1,maxlength:9,minlength:7}},messages:{rgfAtencion:{valueNotEquals:"Seleccione Paciente atendido",required:"Seleccione Paciente atendido"},rgfTdoc:{valueNotEquals:"Selecciona Tipo Doc",required:"Selecciona Tipo Doc"},rgfNdoc:{required:"Ingrese N° Doc",maxlength:"12 caracteres si es CE o PASS",minlength:"8 caracteres si es DNI"},rgfNomAp:{required:"Ingrese nombre de Familiar"},rgfSexo:{valueNotEquals:"Seleccione Sexo",required:"Seleccione Sexo"},rgfParent:{valueNotEquals:"Seleccione parentesco",required:"Seleccione parentesco"},rgfEdad:{required:"Ingrese edad de familiar",maxlength:"Máximo 3 dígitos",minlength:"Mínimo 1 dígito"},rgfTel:{maxlength:"9 dígitos si es celular",minlength:"7 dígitos si es teléfono"}},errorElement:"span",errorPlacement:function(e,a){e.addClass("invalid-feedback"),a.closest(".form-group").append(e)},highlight:function(e,a,t){$(e).addClass("is-invalid")},unhighlight:function(e,a,t){$(e).removeClass("is-invalid")}})}),$(".datatableFamiliares tbody").on("click",".btnEditarFamiliar",function(){var e=$(this).attr("idFamiliar"),a=new FormData;a.append("idFamiliar",e),$.ajax({url:"public/views/src/ajaxFamiliares.php",method:"POST",data:a,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(e){$("#idAteAct").val(e.idAtencion),$("#idDniAct").val(e.ndocFamiliar),$("#seleccionActual").html(e.cuentaAtencion+" || "+e.tipdocFamiliar+"-"+e.ndocFamiliar+" - "+e.nombAtencion+" "+e.apPaternoAtencion+" "+e.apMaternoAtencion),$("#edtfAtencion").val(e.idAtencion),$("#edtfAtencion").html(e.cuentaAtencion+" || "+e.tipdocFamiliar+"-"+e.ndocFamiliar+" - "+e.nombAtencion+" "+e.apPaternoAtencion+" "+e.apMaternoAtencion),$("#idFamiliar").val(e.idFamiliar),$("#edtfNdoc").val(e.ndocFamiliar),$("#edtfTdoc").val(e.tipdocFamiliar),$("#edtfTdoc").html(e.tipdocFamiliar),$("#edtfSexo").val(e.idTipSexo),$("#edtfSexo").html(e.detaTipSexo),$("#edtfParent").val(e.idParentesco),$("#edtfParent").html(e.detaParentesco),$("#edtfEdad").val(e.edadFamiliar),$("#edtfTel").val(e.telcelFamiliar),$("#edtfNomAp").val(e.nombApFamiliar)}})}),$("#btnEdtDNIFam").on("click",function(){var e=$("#edtfTdoc1").val(),a=$("#edtfNdoc").val();8==a.length&&"DNI"==e&&$.ajax({type:"GET",url:"https://dniruc.apisperu.com/api/v1/dni/"+a+"?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6Im9jYXN0cm9wLnRpQGdtYWlsLmNvbSJ9.XtrYx8wlARN2XZwOZo6FeLuYDFT6Ljovf7_X943QC_E",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){null!=e.nombres?(toastr.success("Datos cargados con éxito","RENIEC"),$("#edtfNomAp").val(e.nombres+" "+e.apellidoPaterno+" "+e.apellidoMaterno),$("#edtfSexo1").focus(),$("#edtfNomAp").prop("readonly",!0)):(toastr.warning("Es un menor de edad, ingrese datos manualmente","RENIEC"),$("#edtfNomAp").focus(),$("#edtfNomAp").val(""),$("#edtfNomAp").prop("readonly",!1))},failure:function(e){toastr.info("No se pudo conectar los datos","DNI")},error:function(e){$("#edtfNomAp").prop("readonly",!1),$("#edtDni").focus()}})}),$("#btnEdtFam").on("click",function(){$("#formEdtFam").validate({rules:{edtfAtencion:{valueNotEquals:"0",required:!0},edtfTdoc:{valueNotEquals:"0",required:!0},edtfNdoc:{required:!0,maxlength:12,minlength:8},edtfNomAp:{required:!0},edtfSexo:{valueNotEquals:"0",required:!0},edtfParent:{valueNotEquals:"0",required:!0},edtfEdad:{required:!0,maxlength:3,minlength:1},edtfTel:{required:!1,maxlength:9,minlength:7}},messages:{edtfAtencion:{valueNotEquals:"Seleccione Paciente atendido",required:"Seleccione Paciente atendido"},edtfTdoc:{valueNotEquals:"Selecciona Tipo Doc",required:"Selecciona Tipo Doc"},edtfNdoc:{required:"Ingrese N° Doc",maxlength:"12 caracteres si es CE o PASS",minlength:"8 caracteres si es DNI"},edtfNomAp:{required:"Ingrese nombre de Familiar"},edtfSexo:{valueNotEquals:"Seleccione Sexo",required:"Seleccione Sexo"},rgfParent:{valueNotEquals:"Seleccione parentesco",required:"Seleccione parentesco"},edtfEdad:{required:"Ingrese edad de familiar",maxlength:"Máximo 3 dígitos",minlength:"Mínimo 1 dígito"},edtfTel:{maxlength:"9 dígitos si es celular",minlength:"7 dígitos si es teléfono"}},errorElement:"span",errorPlacement:function(e,a){e.addClass("invalid-feedback"),a.closest(".form-group").append(e)},highlight:function(e,a,t){$(e).addClass("is-invalid")},unhighlight:function(e,a,t){$(e).removeClass("is-invalid")}})}),$("#rgfNdoc").on("change",function(){const e=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500});var a=$(this).val(),t=$("#rgfAtencion").val(),o=$("#rgfTdoc").val(),n=new FormData;"SD"!=o&&a.length>=8&&t>0&&(n.append("Paciente",t),n.append("dniFamiliar",a),$.ajax({url:"public/views/src/ajaxFamiliares.php",method:"POST",data:n,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(a){console.log(a),a?(e.fire({icon:"error",title:"El familiar ingresado, ya existe para el paciente seleccionado"}),$("#rgfNdoc").val(""),$("#rgfNdoc").focus(),$("#rgfNomAp").val("")):$("#btnDNIFam").focus()}}))}),$("#edtfNdoc").on("change",function(){const e=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500});var a=$(this).val(),t=$("#edtfAtencion1").val(),o=$("#edtfTdoc").val(),n=$("#idAteAct").val(),i=$("#idDniAct").val(),r=new FormData;"SD"!=o&&a.length>=8&&t>0&&(t==n&&a!=i?(r.append("Paciente",t),r.append("dniFamiliar",a),$.ajax({url:"public/views/src/ajaxFamiliares.php",method:"POST",data:r,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(a){console.log(a),a?(e.fire({icon:"error",title:"El familiar ingresado, ya existe para el paciente seleccionado"}),$("#edtfNdoc").val(""),$("#edtfNdoc").focus()):$("#btnEdtDNIFam").focus()}})):t!=n&&a!=i&&(r.append("Paciente",t),r.append("dniFamiliar",a),$.ajax({url:"public/views/src/ajaxFamiliares.php",method:"POST",data:r,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(a){console.log(a),a?(e.fire({icon:"error",title:"El familiar ingresado, ya existe para el paciente seleccionado"}),$("#edtfNdoc").val(""),$("#edtfNdoc").focus()):$("#btnEdtDNIFam").focus()}})))}),$(".datatableFamiliares tbody").on("click",".btnEliminarFamiliar",function(){var e=$(this).attr("idFamiliar"),a=$(this).attr("idAtencion"),t=$("#idUsFamOcu").val(),o=$(this).attr("idNDoc");Swal.fire({title:"¿Está seguro de eliminar el familiar?",text:"¡Si no lo está, puede cancelar la acción!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#343a40",cancelButtonText:"No, cancelar",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, eliminar familiar!"}).then(function(n){n.value&&(window.location="index.php?ruta=familiares&idFamiliar="+e+"&idAtencion="+a+"&idNDoc="+o+"&idUsuario="+t)})});