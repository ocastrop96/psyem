$(".datatableUsuarios").DataTable({ajax:"public/views/util/datatable-Usuarios.php",deferRender:!0,retrieve:!0,processing:!0,paging:!0,lengthChange:!0,searching:!0,ordering:!0,order:[[4,"asc"]],info:!0,autoWidth:!1,language:{url:"public/views/resources/js/dataTables.spanish.lang"}}),$("#rgDni").attr("minlength","8"),$("#rgDni").attr("maxlength","12"),$("#rgDni").keyup(function(){this.value=(this.value+"").replace(/[^0-9]/g,"")}),$("#rgNombres").keyup(function(){this.value=(this.value+"").replace(/[^a-zA-ZñÑáéíóúüÁÉÍÓÚÜ ]/g,"")}),$("#rgApellidos").keyup(function(){this.value=(this.value+"").replace(/[^a-zA-ZñÑáéíóúüÁÉÍÓÚÜ ]/g,"")}),$("#rgUsuario").keyup(function(){this.value=(this.value+"").replace(/[^a-zA-ZñÑáéíóúÁÉÍÓÚ]/g,"")}),$("#rgNombres").keyup(function(){var e=$(this).val().toUpperCase();$("#rgNombres").val(e)}),$("#rgApellidos").keyup(function(){var e=$(this).val().toUpperCase();$("#rgApellidos").val(e)}),$("#rgUsuario").keyup(function(){var e=$(this).val().toLowerCase();$("#rgUsuario").val(e)}),$("#rgCorreo").keyup(function(){var e=$(this).val().toLowerCase();$("#rgCorreo").val(e)}),$("#edtDni").attr("minlength","8"),$("#edtDni").attr("maxlength","12"),$("#edtDni").keyup(function(){this.value=(this.value+"").replace(/[^0-9]/g,"")}),$("#edtNombres").keyup(function(){this.value=(this.value+"").replace(/[^a-zA-ZñÑáéíóúüÁÉÍÓÚÜ ]/g,"")}),$("#edtApellidos").keyup(function(){this.value=(this.value+"").replace(/[^a-zA-ZñÑáéíóúüÁÉÍÓÚÜ ]/g,"")}),$("#edtUsuario").keyup(function(){this.value=(this.value+"").replace(/[^a-zA-ZñÑáéíóúÁÉÍÓÚ]/g,"")}),$("#edtNombres").keyup(function(){var e=$(this).val().toUpperCase();$("#rgNombres").val(e)}),$("#edtApellidos").keyup(function(){var e=$(this).val().toUpperCase();$("#edtApellidos").val(e)}),$("#edtUsuario").keyup(function(){var e=$(this).val().toLowerCase();$("#edtUsuario").val(e)}),$("#edtCorreo").keyup(function(){var e=$(this).val().toLowerCase();$("#edtCorreo").val(e)}),$.validator.addMethod("valueNotEquals",function(e,a,r){return r!==e},"Value must not equal arg."),$("#btnRegUsu").on("click",function(){$("#formRegUs").validate({rules:{rgPerfil:{valueNotEquals:"0",required:!0},rgDni:{required:!0,maxlength:12,minlength:8},rgNombres:{required:!0},rgApellidos:{required:!0},rgCorreo:{required:!0,email:!0},rgUsuario:{required:!0},rgClave:{required:!0}},messages:{rgPerfil:{valueNotEquals:"Seleccione Perfil",required:"Seleccione perfil de usuario"},rgDni:{required:"DNI Requerido",maxlength:"Ingrese máximo 12 dígitos",minlength:"Ingrese mínimo 8 dígitos"},rgNombres:{required:"Nombres requerido"},rgApellidos:{required:"Apellidos requerido"},rgCorreo:{required:"Correo requerido",email:"Ingrese un correo válido"},rgUsuario:{required:"Cuenta de usuario requerido"},rgClave:{required:"Contraseña requerida"}},errorElement:"span",errorPlacement:function(e,a){e.addClass("invalid-feedback"),a.closest(".form-group").append(e)},highlight:function(e,a,r){$(e).addClass("is-invalid")},unhighlight:function(e,a,r){$(e).removeClass("is-invalid")}})}),$("#btnEdtUsu").on("click",function(){$("#formEdtUs").validate({rules:{edtPerfil:{valueNotEquals:"0",required:!0},edtDni:{required:!0,maxlength:12,minlength:8},edtNombres:{required:!0},edtApellidos:{required:!0},edtCorreo:{required:!0,email:!0},edtUsuario:{required:!0}},messages:{edtPerfil:{valueNotEquals:"Seleccione Perfil",required:"Seleccione perfil de usuario"},edtDni:{required:"DNI Requerido",maxlength:"Ingrese máximo 12 dígitos",minlength:"Ingrese mínimo 8 dígitos"},edtNombres:{required:"Nombres requerido"},edtApellidos:{required:"Apellidos requerido"},edtCorreo:{required:"Correo requerido",email:"Ingrese un correo válido"},edtUsuario:{required:"Cuenta de usuario requerido"}},errorElement:"span",errorPlacement:function(e,a){e.addClass("invalid-feedback"),a.closest(".form-group").append(e)},highlight:function(e,a,r){$(e).addClass("is-invalid")},unhighlight:function(e,a,r){$(e).removeClass("is-invalid")}})}),$("#rgDni").change(function(){const e=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500});var a=$(this).val(),r=new FormData;r.append("validarDni",a),$.ajax({url:"public/views/src/ajaxUsuarios.php",method:"POST",data:r,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(a){a?(e.fire({icon:"warning",title:"El DNI Ingresado ya se encuentra registrado"}),$("#rgDni").val(""),$("#rgNombres").val(""),$("#rgApellidos").val(""),$("#rgCorreo").val(""),$("#rgUsuario").val(""),$("#rgClave").val("")):($("#rgNombres").val(""),$("#rgApellidos").val(""),$("#btnDNIU").on("click",function(){var e=$("#rgDni").val();(e.length=8)&&$.ajax({type:"GET",url:"https://dniruc.apisperu.com/api/v1/dni/"+e+"?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6Im9jYXN0cm9wLnRpQGdtYWlsLmNvbSJ9.XtrYx8wlARN2XZwOZo6FeLuYDFT6Ljovf7_X943QC_E",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){$("#rgNombres").val(e.nombres),$("#rgApellidos").val(e.apellidoPaterno+" "+e.apellidoMaterno),$("#rgPerfil").focus(),$("#rgNombres").prop("readonly",!0),$("#rgApellidos").prop("readonly",!0)},failure:function(e){toastr.info("No se pudo conectar los datos","DNI")},error:function(e){$("#rgNombres").prop("readonly",!1),$("#rgApellidos").prop("readonly",!1),$("#rgDni").focus(),$("#formRegUs").trigger("reset")}})}))}})}),$("#edtDni").change(function(){const e=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500});var a=$(this).val(),r=new FormData;r.append("validarDni",a),$.ajax({url:"public/views/src/ajaxUsuarios.php",method:"POST",data:r,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(a){a?(e.fire({icon:"warning",title:"El DNI Ingresado ya se encuentra registrado"}),$("#edtDni").val(""),$("#edtDni").focus()):($("#edtNombres").val(""),$("#edtApellidos").val(""),$("#btnDNIUEdt").on("click",function(){var e=$("#edtDni").val();(e.length=8)&&$.ajax({type:"GET",url:"https://dniruc.apisperu.com/api/v1/dni/"+e+"?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6Im9jYXN0cm9wLnRpQGdtYWlsLmNvbSJ9.XtrYx8wlARN2XZwOZo6FeLuYDFT6Ljovf7_X943QC_E",contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){$("#edtNombres").val(e.nombres),$("#edtApellidos").val(e.apellidoPaterno+" "+e.apellidoMaterno),$("#edtPerfil").focus(),$("#edtNombres").prop("readonly",!0),$("#edtApellidos").prop("readonly",!0)},failure:function(e){toastr.info("No se pudo conectar los datos","DNI")},error:function(e){$("#edtNombres").prop("readonly",!1),$("#edtApellidos").prop("readonly",!1),$("#edtDni").focus(),$("#formEdtUs").trigger("reset")}})}))}})}),$(".datatableUsuarios tbody").on("click",".btnEditarUsuario",function(){var e=$(this).attr("idUsuario"),a=new FormData;a.append("idUsuario",e),$.ajax({url:"public/views/src/ajaxUsuarios.php",method:"POST",data:a,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(e){$("#idUsuario").val(e.idUsuario),$("#edtDni").val(e.dniUsuario),$("#edtNombres").val(e.nombresUsuario),$("#edtApellidos").val(e.apellidosUsuario),$("#edtPerfil").val(e.idPerfil),$("#edtPerfil").html(e.detallePerfil),$("#edtCorreo").val(e.correoUsuario),$("#edtUsuario").val(e.cuentaUsuario),$("#passActual").val(e.claveUsuario)}})}),$(".datatableUsuarios tbody").on("click",".btnHabilitar",function(){var e=$(this).attr("idUsuario"),a=$(this).attr("idEstado"),r=new FormData;r.append("idUsuario2",e),r.append("idEstado",a),$.ajax({url:"public/views/src/ajaxUsuarios.php",method:"POST",data:r,cache:!1,contentType:!1,processData:!1,success:function(e){1==a?toastr.success("¡La cuenta de usuario ha sido habilitada!"):toastr.error("¡La cuenta de usuario ha sido inhabilitada!")}}),2==a?($(this).removeClass("btn-success"),$(this).addClass("btn-danger"),$(this).html('<i class="fas fa-user-minus"></i>INHABILITADO'),$(this).attr("idEstado",1)):($(this).addClass("btn-success"),$(this).removeClass("btn-danger"),$(this).html('<i class="fas fa-user-check"></i>HABILITADO'),$(this).attr("idEstado",2))}),$(".datatableUsuarios tbody").on("click",".btnDesbloquearUsuario",function(){var e=$(this).attr("idUsuario"),a=new FormData;a.append("idUsuario3",e),$.ajax({url:"public/views/src/ajaxUsuarios.php",method:"POST",data:a,cache:!1,contentType:!1,processData:!1,success:function(e){toastr.info("¡La cuenta de usuario ha sido desbloqueada!")}})}),$(".datatableUsuarios tbody").on("click",".btnEliminarUsuario",function(){var e=$(this).attr("idUsuario");Swal.fire({title:"¿Está seguro de eliminar al usuario?",text:"¡Si no lo está, puede cancelar la acción!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#343a40",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, eliminar Usuario!",cancelButtonText:"¡No, cancelar"}).then(function(a){a.value&&(window.location="index.php?ruta=usuarios&idUsuario="+e)})});